@page
@model ARS_FE.Pages.Staff.CancelBookingManagement.UserRefundAccountDetailsModel
@{
    ViewData["Title"] = "Refund Bank Account Details";
    Layout = "_LayoutManage";
}

<div class="container my-5">
    <!-- Page Title -->
    <h1 class="text-primary mb-4">Booking Details for @Model.Booking.UserName</h1>

    <!-- Ticket Details Section -->
    <section class="mb-5">
        <h2 class="text-center mb-4 text-secondary">Ticket Details</h2>

        @if (Model.Tickets == null || !Model.Tickets.Any())
        {
            <div class="alert alert-info text-center">
                No tickets found for this booking.
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-bordered table-hover text-center">
                    <thead class="bg-primary text-white">
                        <tr>
                            <th>Class</th>
                            <th>Price</th>
                            <th>Passenger Name</th>
                            <th>Gender</th>
                            <th>Date of Birth</th>
                            <th>Country</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var ticket in Model.Tickets)
                        {
                            <tr>
                                <td>@ticket.ClassName</td>
                                <td>@String.Format("{0:#,##0} VND", Convert.ToDecimal(ticket.ClassPrice))</td>
                                <td>@ticket.FirstName @ticket.LastName</td>
                                <td>@ticket.Gender</td>
                                <td>@ticket.Dob.ToString("yyyy-MM-dd")</td>
                                <td>@ticket.Country</td>
                                <td>
                                    @{
                                        string statusClass = ticket.Status switch
                                        {
                                            "Pending" => "badge bg-warning text-dark",
                                            "Paid" => "badge bg-success text-white",
                                            "Cancelled" => "badge bg-danger",
                                            _ => "badge bg-secondary"
                                        };
                                    }
                                    <span class="@statusClass">@ticket.Status</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </section>

    <!-- Booking Summary Section -->
    <section class="mb-5">
        <h4 class="text-secondary">Booking Summary</h4>
        <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <strong>Total Amount:</strong>
                <span>@String.Format("{0:#,##0} VND", Model.Booking.TotalAmount)</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <strong>Discount:</strong>
                <span>@Model.Booking.Discount%</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <strong>Price After Discount:</strong>
                <span>@String.Format("{0:#,##0} VND", Model.Booking.TotalAmount * (100 - Model.Booking.Discount) / 100)</span>
            </li>
        </ul>
    </section>

    <!-- Refund Bank Account Details Section -->
    <section class="mb-5">
        <h4 class="text-center mb-4 text-secondary">Refund Bank Account Details</h4>
        <div class="card shadow-sm p-4">
            <dl class="row">
                <dt class="col-sm-3 fw-bold">Account Name</dt>
                <dd class="col-sm-9">@Model.RefundBankAccount.AccountName</dd>

                <dt class="col-sm-3 fw-bold">Account Number</dt>
                <dd class="col-sm-9">@Model.RefundBankAccount.AccountNumber</dd>

                <dt class="col-sm-3 fw-bold">Bank Name</dt>
                <dd class="col-sm-9">@Model.RefundBankAccount.BankName</dd>
            </dl>
        </div>
    </section>

    <!-- Action Buttons Section -->
    <section class="d-flex justify-content-between">
        <a asp-page="./Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to List
        </a>

        @if (Model.Booking.IsRefund == false)
        {
            <form method="post" asp-page-handler="Cancel">
                <input type="hidden" name="id" value="@Model.RefundBankAccount.BookingId" />
                <button type="submit" class="btn btn-danger">
                    <i class="bi bi-x-circle"></i> Process Refund
                </button>
            </form>
        }
    </section>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
